{% extends "base.html" %}

{% block title %}观看复盘{% endblock %}

{% block content %}
<audio id="moveSound" src="/static/audio/move.mp3" preload="auto"></audio>
<audio id="40lostSound" src="/static/audio/40lost.mp3" preload="auto"></audio>
<audio id="winSound" src="/static/audio/win.mp3" preload="auto"></audio>
<audio id="loseSound" src="/static/audio/lose.mp3" preload="auto"></audio>
<audio id="drawSound" src="/static/audio/draw.mp3" preload="auto"></audio>

<div class="row">
    <div class="col-md-4">
        <div class="card mb-4">
            <div class="card-header d-flex justify-content-between align-items-center">
                <h4 class="mb-0">对局复盘</h4>
                <a href="/replay_list" class="btn btn-secondary">返回列表</a>
            </div>
            <div class="card-body">
                <div id="playersList" class="list-group list-group-flush">
                    {% for idx, player in players %}
                        <div class="list-group-item d-flex justify-content-between align-items-center">
                            <span class="badge me-2" style="background:{{ colors[idx + 1] }}">{{ idx + 1 }}号位</span>
                            <span>{{ player }}</span>
                        </div>
                    {% endfor %}
                </div>
                <div>
                    <div class="d-flex justify-content-center">
                        <div class="btn-group mb-2" role="group" aria-label="Replay controls">
                            <button type="button" class="btn btn-primary mx-2" onclick="prevStep()">
                                <i class="fa-solid fa-backward"></i>
                            </button>
                            <button type="button" class="btn btn-primary mx-2" onclick="playPause()">
                                <i class="fa-solid fa-play" id="playPauseBtn"></i>
                            </button>
                            <button type="button" class="btn btn-primary mx-2" onclick="nextStep()">
                                <i class="fa-solid fa-forward"></i>
                            </button>
                        </div>
                    </div>
                    <input type="range" class="form-range" min="1" max="{{ records.__len__() }}" value="1" id="replayRange" oninput="updateReplay(this.value)">
                    <div class="d-flex justify-content-between">
                        <span>1</span>
                        <span id="currentStep">1</span>
                        <span>{{ records.__len__() }}</span>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- 右侧：棋盘 -->
    <div class="col-md-8">
        <div class="card" style="width: 1032px;">
            <div class="card-header">
                <h3 class="mb-0"><i class="fas fa-chess-rook me-2"></i>对局棋盘</h3>
            </div>
            <div class="card-body">
                <div class="text-center my-4" style="height: 1000px; position: relative;" id="boardContainer">
                    <img id="board-img" src="/static/img/{{ room_type }}.jpg" alt="军旗棋盘" class="img-fluid" style="max-height: 100%; max-width: 100%;">
                    <svg id="arrowLayer" width="100%" height="100%" 
                        style="position:absolute; top:0; left:0; pointer-events:none; z-index:20;">
                        <defs>
                        <marker id="arrowheadB" markerWidth="10" markerHeight="7" 
                                refX="10" refY="3.5" orient="auto" fill="black">
                            <polygon points="0 0, 10 3.5, 0 7" />
                        </marker>
                        </defs>
                    </svg>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
let colors = {{ colors | tojson }};
let autoPlayInterval = null;
let records = {{ records|tojson }};
let chessMap = {};
</script>
<script src="/static/js/replay.js"></script>

{% endblock %}